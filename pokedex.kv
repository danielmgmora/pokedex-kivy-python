#:kivy 2.0
#:import rgba kivy.utils.rgba

<SelectableRecycleBoxLayout>:
    default_size: None, dp(56)
    default_size_hint: 1, None
    size_hint_y: None
    height: self.minimum_height
    orientation: 'vertical'
    multiselect: False
    touch_multiselect: False

<PokemonListItem>:
    canvas.before:
        Color:
            rgba: rgba('#3498DB') if self.selected else (1,1,1,0.1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10,]
    AsyncImage:
        source: root.pokemon_image
        size_hint_x: 0.2
        on_error: self.source = ''
        on_touch_down: if self.collide_point(*args[1].pos): app.root.get_screen('main').ids.right_panel.show_image_popup(self.source)
    Label:
        text: root.pokemon_name
        size_hint_x: 0.8
        halign: 'left'
        valign: 'middle'
        text_size: self.size
        font_size: '16sp'
        bold: True
        color: 1,1,1,1

<SuggestionCardItem>:
    size_hint_y: None
    height: dp(70)
    canvas.before:
        Color:
            rgba: 0.2, 0.2, 0.2, 0.9
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10,]
    BoxLayout:
        spacing: 10
        padding: 5
        AsyncImage:
            source: root.pokemon_image
            size_hint_x: 0.2
            allow_stretch: True
            keep_ratio: True
            on_error: self.source = ''
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.8
            Label:
                text: f"#{root.pokemon_id} {root.pokemon_name}"
                font_size: '16sp'
                bold: True
                color: 1,1,1,1
                halign: 'left'
                text_size: self.size
            Label:
                text: root.pokemon_types
                font_size: '14sp'
                color: 0.8,0.8,0.8,1
                halign: 'left'
                text_size: self.size

<LeftPanel>:
    orientation: 'vertical'
    spacing: 10
    padding: 10
    canvas.before:
        Color:
            rgba: rgba('#2C3E50')
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [20,]
    BoxLayout:
        size_hint_y: None
        height: 40
        spacing: 5
        TextInput:
            id: search_input
            hint_text: 'Buscar Pokémon...'
            multiline: False
            background_color: 1,1,1,1
            foreground_color: 0,0,0,1
            font_size: '16sp'
        Button:
            text: 'Buscar'
            size_hint_x: 0.3
            background_normal: ''
            background_color: rgba('#F1C40F')
            color: 0,0,0,1
            font_size: '16sp'
            bold: True
            on_press: root.search_pokemon(search_input.text); root.filter_list(search_input.text)
        Button:
            text: 'Anterior'
            on_press: root.go_to_page(root.current_page - 1)
            disabled: root.current_page == 1
        Label:
            text: f'{root.current_page} / {root.total_pages}'
            size_hint_x: 0.4
            color: 1,1,1,1
        Button:
            text: 'Siguiente'
            on_press: root.go_to_page(root.current_page + 1)
            disabled: root.current_page == root.total_pages
    RecycleView:
        id: suggestions_view
        size_hint_y: None
        height: 0
        opacity: 0
        viewclass: 'SuggestionCardItem'
        RecycleBoxLayout:
            default_size: None, dp(70)
            default_size_hint: 1, None
            size_hint_y: None
            height: self.minimum_height
            orientation: 'vertical'
    RecycleView:
        id: pokemon_list
        viewclass: 'PokemonListItem'
        SelectableRecycleBoxLayout:
            default_size: None, dp(56)
            default_size_hint: 1, None
            size_hint_y: None
            height: self.minimum_height
            orientation: 'vertical'

<RightPanel>:
    orientation: 'vertical'
    spacing: 10
    padding: 10
    canvas.before:
        Color:
            rgba: rgba('#2C3E50')
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [20,]
    AsyncImage:
        id: pokemon_image_main
        size_hint_y: 0.25
        allow_stretch: True
        keep_ratio: True
    Label:
        id: pokemon_name
        size_hint_y: 0.05
        font_size: '24sp'
        color: 1,1,1,1
        halign: 'center'
    BoxLayout:
        size_hint_y: 0.2
        height: 150
        spacing: 10
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.5
            AsyncImage:
                id: pokemon_image_front
                source: ''
                allow_stretch: True
                keep_ratio: True
                on_error: self.source = ''
                on_touch_down: if self.collide_point(*args[1].pos): root.show_image_popup(self.source)
            Label:
                text: 'Versión Oficial'
                size_hint_y: None
                height: 20
                color: 1,1,1,1
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.5
            AsyncImage:
                id: pokemon_image_shiny
                source: ''
                allow_stretch: True
                keep_ratio: True
                on_error: self.source = ''
                on_touch_down: if self.collide_point(*args[1].pos): root.show_image_popup(self.source)
            Label:
                text: 'Versión Shiny'
                size_hint_y: None
                height: 20
                color: 1,1,1,1
    Button:
        text: 'Ver espalda'
        size_hint_y: 0.05
        height: 40
        on_press: root.toggle_back_view()
    TabbedPanel:
        do_default_tab: False
        tab_width: dp(120)
        background_color: rgba('#3498DB')
        size_hint_y: 0.45
        TabbedPanelHeader:
            text: 'Descripción'
            background_color: rgba('#3498DB') if self.state == 'down' else rgba('#2980B9')
            color: 1,1,1,1
            font_size: '14sp'
            bold: True
            ScrollView:
                BoxLayout:
                    id: info_content
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 5
                    padding: 10
        TabbedPanelHeader:
            text: 'Sprites'
            background_color: rgba('#3498DB') if self.state == 'down' else rgba('#2980B9')
            color: 1,1,1,1
            font_size: '14sp'
            bold: True
            ScrollView:
                BoxLayout:
                    id: sprites_content
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 5
                    padding: 10
        TabbedPanelHeader:
            text: 'Evoluciones'
            background_color: rgba('#3498DB') if self.state == 'down' else rgba('#2980B9')
            color: 1,1,1,1
            font_size: '14sp'
            bold: True
            ScrollView:
                BoxLayout:
                    id: evolutions_content
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 5
                    padding: 10
        TabbedPanelHeader:
            text: 'Ubicaciones'
            background_color: rgba('#3498DB') if self.state == 'down' else rgba('#2980B9')
            color: 1,1,1,1
            font_size: '14sp'
            bold: True
            ScrollView:
                BoxLayout:
                    id: locations_content
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 5
                    padding: 10
        TabbedPanelHeader:
            text: 'Sprites'
            background_color: rgba('#3498DB') if self.state == 'down' else rgba('#2980B9')
            color: 1,1,1,1
            font_size: '14sp'
            bold: True
            ScrollView:
                BoxLayout:
                    id: sprites_content
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 5
                    padding: 10

<MainScreen>:
    name: 'main'
    BoxLayout:
        orientation: 'horizontal'
        LeftPanel:
            id: left_panel
            size_hint_x: 0.4
        RightPanel:
            id: right_panel
            size_hint_x: 0.6
